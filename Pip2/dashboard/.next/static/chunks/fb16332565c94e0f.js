(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,13271,e=>{"use strict";var r=e.i(10561),a=e.i(9805),s=e.i(73e3),t=e.i(56488);function n(){let{data:e,status:n}=(0,t.useSession)(),[i,l]=(0,s.useState)([]),[d,o]=(0,s.useState)(null),[c,g]=(0,s.useState)([]),[m,x]=(0,s.useState)(null),[h,b]=(0,s.useState)(!0),[u,p]=(0,s.useState)(!1),[y,f]=(0,s.useState)(null),N=[{name:"rollcloud",description:"Connect your RollCloud extension to Discord",category:"RollCloud",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"character",description:"Set your active character for rolls",category:"RollCloud",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"characters",description:"List your synced characters",category:"RollCloud",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"sheet",description:"View character sheet information",category:"RollCloud",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"stats",description:"Quick stat lookup and rolls",category:"RollCloud",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"roll",description:"Roll dice with modifiers",category:"Utility",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"ping",description:"Check bot responsiveness",category:"Utility",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"help",description:"Show help information",category:"Utility",defaultPermissions:["USE_APPLICATION_COMMANDS"],enabled:!0},{name:"reactionrole",description:"Configure reaction roles",category:"Moderation",defaultPermissions:["MANAGE_ROLES"],enabled:!1},{name:"changelog",description:"Manage changelog entries",category:"Moderation",defaultPermissions:["MANAGE_MESSAGES"],enabled:!1},{name:"ticket",description:"Create and manage tickets",category:"Moderation",defaultPermissions:["MANAGE_CHANNELS"],enabled:!1}];(0,s.useEffect)(()=>{"authenticated"===n?v():b(!1)},[n]);let v=async()=>{try{let e=await fetch("/api/discord/servers");if(!e.ok){if(401===e.status)throw Error("Discord token expired");throw Error("Failed to fetch servers")}let r=await e.json(),a=(await Promise.all(r.map(async e=>{let r=await j(e.id);return{...e,botMember:r}}))).filter(e=>e.permissions.includes("ADMINISTRATOR")||e.permissions.includes("MANAGE_GUILD"));l(a),g(N)}catch(e){console.error("Error loading servers:",e),l([]),g([])}finally{b(!1)}},j=async e=>{try{let r=await fetch(`/api/discord/bot-in-server/${e}`);if(r.ok)return(await r.json()).botPresent;return!1}catch(e){return console.error("Error checking bot presence:",e),!1}},k=async e=>{f(e);try{let a=r.default.env.NEXT_PUBLIC_DISCORD_CLIENT_ID||"YOUR_BOT_CLIENT_ID",s=`https://discord.com/oauth2/authorize?client_id=${a}&permissions=VIEW_CHANNEL%20SEND_MESSAGES%20USE_APPLICATION_COMMANDS%20MANAGE_ROLES%20MANAGE_CHANNELS%20MANAGE_MESSAGES%20EMBED_LINKS%20ATTACH_FILES%20READ_MESSAGE_HISTORY&scope=bot%20applications.commands&guild_id=${e}`;window.open(s,"_blank"),setTimeout(()=>{v(),f(null)},5e3)}catch(e){console.error("Error inviting bot:",e),f(null)}},w=async e=>{try{x({id:e,welcomeChannel:"welcome-channel",logChannel:"logs",adminRole:"Admin",modRole:"Moderator",autoRoles:["Member"]})}catch(e){console.error("Error loading server settings:",e)}},C=async()=>{if(d){p(!0);try{await new Promise(e=>setTimeout(e,1e3));let e=c.filter(e=>e.enabled);console.log(`Saving configuration for server ${d.name}:`,e),alert(`Configuration saved for ${d.name}!

Enabled commands: ${e.length}/${c.length}`)}catch(e){console.error("Error saving configuration:",e),alert("Failed to save configuration. Please try again.")}finally{p(!1)}}},A=c.reduce((e,r)=>(e[r.category]||(e[r.category]=[]),e[r.category].push(r),e),{});return"loading"===n||h?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-64",children:(0,a.jsx)("div",{className:"text-green-600",children:"Loading..."})}):e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Configure Pip"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage slash commands and settings for servers where you're an admin"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("img",{src:e.user?.image||"",alt:e.user?.name||"",className:"w-10 h-10 rounded-full"}),(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:e.user?.name})]})]})}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Select Server"}),0===i.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Servers Found"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"You don't have any Discord servers where you have admin permissions, or Pip isn't in any of your servers yet."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Want to add Pip to a server?"}),(0,a.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-3",children:"You can invite Pip to any Discord server where you have admin permissions."}),(0,a.jsx)("button",{onClick:()=>window.open("https://discord.com/oauth2/authorize?client_id=YOUR_BOT_CLIENT_ID&permissions=8&scope=bot%20applications.commands","_blank"),className:"bg-[#5865F2] hover:bg-[#4752C4] text-white px-4 py-2 rounded-lg font-medium transition",children:"Invite Pip to Server"})]}),(0,a.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-900 dark:text-green-100 mb-2",children:"Create a new server"}),(0,a.jsx)("p",{className:"text-sm text-green-800 dark:text-green-200 mb-3",children:"Don't have a server yet? Create a new Discord server to get started with Pip."}),(0,a.jsx)("button",{onClick:()=>window.open("https://discord.com/new","_blank"),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition",children:"Create New Server"})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:(0,a.jsx)("p",{children:"After adding Pip to a server or creating a new one, refresh this page to see your servers."})})]})]}):(0,a.jsx)("div",{className:"grid gap-4",children:i.map(e=>(0,a.jsx)("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${d?.id===e.id?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-600 hover:border-gray-300 dark:hover:border-gray-500"}`,onClick:()=>{o(e),w(e.id)},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.icon?(0,a.jsx)("img",{src:`https://cdn.discordapp.com/icons/${e.id}/${e.icon}.png`,alt:e.name,className:"w-12 h-12 rounded-full"}):(0,a.jsx)("span",{className:"text-gray-600 dark:text-gray-300 font-bold",children:e.name.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[e.name,e.owner&&(0,a.jsx)("span",{className:"text-xs bg-yellow-500 text-white px-2 py-1 rounded",children:"Owner"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsx)("span",{className:e.botMember?"text-green-600":"text-red-600",children:e.botMember?"✅ Pip is in server":"❌ Pip not in server"}),(0,a.jsx)("span",{children:e.permissions.includes("ADMINISTRATOR")?"Administrator":"Manage Server"})]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:!e.botMember&&(0,a.jsx)("button",{onClick:r=>{r.stopPropagation(),k(e.id)},disabled:y===e.id,className:"bg-[#5865F2] hover:bg-[#4752C4] text-white px-3 py-1.5 rounded text-sm font-medium transition disabled:opacity-50",children:y===e.id?"Inviting...":"Invite Pip"})})]})},e.id))})]}),d&&d.botMember&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold",children:["Slash Commands for ",d.name]}),(0,a.jsx)("button",{onClick:C,disabled:u,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition disabled:opacity-50",children:u?"Saving...":"Save Configuration"})]}),(0,a.jsx)("div",{className:"space-y-6",children:Object.entries(A).map(([e,r])=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-3 text-green-600 dark:text-green-400",children:e}),(0,a.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("code",{className:"bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded text-sm",children:["/",e.name]}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Requires: ",e.defaultPermissions.join(", ")]})]}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:e.enabled,onChange:()=>{var r;return r=e.name,void g(e=>e.map(e=>e.name===r?{...e,enabled:!e.enabled}:e))},className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"})]})]},e.name))})]},e))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold mb-6",children:["Server Settings for ",d.name]}),m?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-3",children:"Channel Configuration"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Welcome Channel"}),(0,a.jsx)("input",{type:"text",value:m.welcomeChannel||"",onChange:e=>x(r=>r?{...r,welcomeChannel:e.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"#welcome"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Log Channel"}),(0,a.jsx)("input",{type:"text",value:m.logChannel||"",onChange:e=>x(r=>r?{...r,logChannel:e.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"#logs"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-lg mb-3",children:"Role Configuration"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Admin Role"}),(0,a.jsx)("input",{type:"text",value:m.adminRole||"",onChange:e=>x(r=>r?{...r,adminRole:e.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Admin"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Moderator Role"}),(0,a.jsx)("input",{type:"text",value:m.modRole||"",onChange:e=>x(r=>r?{...r,modRole:e.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Moderator"})]})]})]}),(0,a.jsx)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,a.jsx)("strong",{children:"Note:"})," Changes may take a few minutes to take effect in Discord. Some features require specific bot permissions to function properly."]})})]}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading server settings..."})})]})]})]}):(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 border border-gray-200 dark:border-gray-700 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-[#5865F2] rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-white",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"Configure Pip"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Connect with Discord to manage Pip's slash commands and server settings"}),(0,a.jsxs)("button",{onClick:()=>(0,t.signIn)("discord"),className:"bg-[#5865F2] hover:bg-[#4752C4] text-white px-6 py-3 rounded-lg font-medium transition flex items-center gap-3 mx-auto",children:[(0,a.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,a.jsx)("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"})}),"Sign in with Discord"]})]})})}e.s(["default",()=>n])}]);